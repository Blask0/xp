<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>ImageCanvas test page</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../admin/common/styles/_all.css">

    <style>

        .display-area {
            width: 800px;
            height: 700px;
            background: #F1F1F1;
            margin: 10px auto;
            position: relative;
            overflow: auto;
        }

        .settings-area {
            width: 800px;
            margin: 10px auto;
        }

        .settings-area:after {
            content: '';
            display: table;
            clear: both;
        }

        .display-area-settings {
            width: 50%;
            float: left;
        }

        .image-canvas-settings {
            width: 50%;
            float: right;
        }

        .image-canvas-settings input {
            float: left;
        }

        .image-canvas-settings span {
            float: left;
            margin-left: 20px;
        }

        .image-canvas-settings label {
            clear: left;
        }

        label, input, select {
            display: block;
        }

        h4 {
            margin: 0 0 10px;
        }

        .display-area > img,
        .display-area > .image-canvas {
            position: absolute;
        }

    </style>

</head>
<body>

<!-- Configuration -->
<script type="text/javascript">
    var CONFIG = {
        baseUri: '../../../..'
    };
</script>

<!-- include source files here... -->
<script type="text/javascript" src="../../../../../../admin/common/lib/_all.js"></script>
<script type="text/javascript" src="../../../../../../admin/common/js/_all.js"></script>

<!-- include spec files here... -->
<script type="text/javascript">

    var DivEl = api.dom.DivEl,
            InputEl = api.dom.InputEl,
            LabelEl = api.dom.LabelEl,
            SpanEl = api.dom.SpanEl;

    // create markup
    ////////////////////////////////////////////

    var displayArea = new DivEl('display-area');
    api.dom.Body.get().appendChild(displayArea);

    var image = new api.dom.ImgEl();
    displayArea.appendChild(image);

    var imageCanvas = new api.ui.image.ImageCanvas(image);

    var settingsArea = new DivEl('settings-area');
    api.dom.Body.get().appendChild(settingsArea);


    var displayAreaSettings = new DivEl('display-area-settings');
    settingsArea.appendChild(displayAreaSettings);

    var displayAreaHeader = new api.dom.H4El();
    displayAreaHeader.getEl().setInnerHtml('Display area settings');
    displayAreaSettings.appendChild(displayAreaHeader);

    var backgroundInput = new InputEl().setName('background-color').setId('background-color');
    displayAreaSettings.appendChild(new LabelEl('Background color', backgroundInput));
    displayAreaSettings.appendChild(backgroundInput);

    var imageSelect = new api.dom.SelectEl().setName('image-url').setId('image-url');
    displayAreaSettings.appendChild(new LabelEl('Image', imageSelect));
    displayAreaSettings.appendChild(imageSelect);

    imageSelect.appendChild(new api.dom.OptionEl('', ''));
    imageSelect.appendChild(new api.dom.OptionEl('sunset_city_320x170.jpg', 'sunset city, 320×170px'));
    imageSelect.appendChild(new api.dom.OptionEl('tree_in_sunrise_1280x854.jpg', 'tree in sunrise, 1280×854px'));
    imageSelect.appendChild(new api.dom.OptionEl('cave_140x240.jpg', 'cave, 140×240px'));
    imageSelect.appendChild(new api.dom.OptionEl('green_railway_683x1024.jpg', 'green railway, 683×1024px'));
    imageSelect.appendChild(new api.dom.OptionEl('egypt-c-pattern-2300x1566.png', 'egypt c pattern, 2300x1566px'));
    imageSelect.appendChild(new api.dom.OptionEl('colorful-floral-pattern-1920x1080.jpg', 'colorful floral pattern, 1920x1080px'));
    imageSelect.appendChild(new api.dom.OptionEl('school-fantasy-2300x1566.gif', 'school fantasy, 2300x1566px'));

    var positionLeftInput = new InputEl(null, 'number').setName('position-left').setId('position-left');
    displayAreaSettings.appendChild(new LabelEl('Position left', positionLeftInput));
    displayAreaSettings.appendChild(positionLeftInput);

    var positionTopInput = new InputEl(null, 'number').setName('position-top').setId('position-top');
    displayAreaSettings.appendChild(new LabelEl('Position top', positionTopInput));
    displayAreaSettings.appendChild(positionTopInput);


    var imageCanvasSettings = new DivEl('image-canvas-settings');
    settingsArea.appendChild(imageCanvasSettings);

    var imageCanvasHeader = new api.dom.H4El();
    imageCanvasHeader.getEl().setInnerHtml('Image settings');
    imageCanvasSettings.appendChild(imageCanvasHeader);

    var enableCanvasCheckbox = new InputEl(null, 'checkbox').setName('enable-canvas').setId('enable-canvas');
    imageCanvasSettings.appendChild(new LabelEl('Enable canvas', enableCanvasCheckbox));
    imageCanvasSettings.appendChild(enableCanvasCheckbox);

    var imageWidthInput = new InputEl(null, 'number').setName('image-width').setId('image-width');
    imageCanvasSettings.appendChild(new LabelEl('Image width', imageWidthInput));
    imageCanvasSettings.appendChild(imageWidthInput);

    var imageWidthSpan = new SpanEl();
    imageCanvas.onWidthChanged(function (width) {
        imageWidthSpan.setHtml(width);
    });
    imageCanvasSettings.appendChild(imageWidthSpan);

    var imageZoomInput = new InputEl(null, 'number').setName('image-zoom').setId('image-zoom');
    imageZoomInput.getEl().setAttribute('min', '100');
    imageCanvasSettings.appendChild(new LabelEl('Image zoom', imageZoomInput));
    imageCanvasSettings.appendChild(imageZoomInput);

    var imageZoomSpan = new SpanEl();
    imageCanvas.onZoomChanged(function (zoom) {
        imageZoomSpan.setHtml(zoom);
        imageZoomInput.setValue(zoom);
    });
    imageCanvasSettings.appendChild(imageZoomSpan);

    var imagePanLeftInput = new InputEl(null, 'number').setName('image-pan-left').setId('image-pan-left');
    imageCanvasSettings.appendChild(new LabelEl('Pan left', imagePanLeftInput));
    imageCanvasSettings.appendChild(imagePanLeftInput);
    var imagePanLeftSpan = new SpanEl();
    imageCanvas.onPanChanged(function (x, y) {
        imagePanLeftSpan.setHtml(x);
        imagePanLeftInput.setValue(x);
    });
    imageCanvasSettings.appendChild(imagePanLeftSpan);

    var imagePanTopInput = new InputEl(null, 'number').setName('image-pan-top').setId('image-pan-top');
    imageCanvasSettings.appendChild(new LabelEl('Pan top', imagePanTopInput));
    imageCanvasSettings.appendChild(imagePanTopInput);
    var imagePanTopSpan = new SpanEl();
    imageCanvas.onPanChanged(function (x, y) {
        imagePanTopSpan.setHtml(y);
        imagePanTopInput.setValue(y);
    });
    imageCanvasSettings.appendChild(imagePanTopSpan);

    // setup listeners
    ////////////////////////////////////////////////////

    backgroundInput.onInput(function () {
        displayArea.getHTMLElement().style.backgroundColor = backgroundInput.getValue();
    });

    var loadHandler = function () {
        var width = image.getEl().getWidth();
        imageCanvas.setWidth(width);
        imageWidthInput.setValue(width);
    };
    imageSelect.onChange(function () {
        image.getEl().setWidth('auto');
        image.setSrc(imageSelect.getValue());
        if (image.isLoaded()) {
            loadHandler();
        } else {
            image.onLoaded(loadHandler);
        }
    });

    positionLeftInput.onInput(function () {
        if (imageCanvas.isEnabled()) {
            imageCanvas.getEl().setLeftPx(positionLeftInput.getValue());
        } else {
            image.getEl().setLeftPx(positionLeftInput.getValue());
        }
    });
    positionLeftInput.setValue(0);

    positionTopInput.onInput(function () {
        if (imageCanvas.isEnabled()) {
            imageCanvas.getEl().setTopPx(positionTopInput.getValue());
        } else {
            image.getEl().setTopPx(positionTopInput.getValue());
        }
    });
    positionTopInput.setValue(0);


    enableCanvasCheckbox.onChange(function () {
        imageCanvas.setEnabled(enableCanvasCheckbox.getHTMLElement()["checked"]);
        if (imageCanvas.isEnabled()) {
            imageCanvas.getEl().setTopPx(positionTopInput.getValue()).setLeftPx(positionLeftInput.getValue());
        } else {
            imageWidthSpan.setHtml('');
            imageZoomSpan.setHtml('');
            imagePanLeftSpan.setHtml('');
            imagePanTopSpan.setHtml('');
        }
    });

    imageWidthInput.onInput(function () {
        imageCanvas.setWidth(imageWidthInput.getValue());
    });
    imageWidthInput.setValue(image.getEl().getWidth());

    imageZoomInput.onInput(function () {
        imageCanvas.setZoom(Math.max(imageZoomInput.getValue(), 100));
    });
    imageZoomInput.setValue(100);

    imagePanLeftInput.onInput(function () {
        imageCanvas.setPan(imagePanLeftInput.getValue(), imageCanvas.getPan().y);
    });
    imagePanLeftInput.setValue(0);

    imagePanTopInput.onInput(function () {
        imageCanvas.setPan(imageCanvas.getPan().x, imagePanTopInput.getValue());
    });
    imagePanTopInput.setValue(0);


</script>


</body>
</html>
